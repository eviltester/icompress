<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
    <!--
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'">
    -->
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />

    <meta http-equiv="X-Content-Security-Policy" content="default-src 'self'; script-src 'self'">
    <title>iCompress Images</title>
</head>
<body>
<h1>iCompress</h1>
<div>
    <button id="compresssinglefile">Compress Image In Folder</button>
</div>
<div>
    <pre id="imageresponse"></pre>
    <p id="messageresponse"></p>
</div>


<script>
    const {ipcRenderer} = require( 'electron' );

    document.getElementById( 'compresssinglefile' ).onclick = function() {
        console.log("click")
        console.log('sending message')
        ipcRenderer.invoke('app:compress-images-insitu').then(
            (result) => {
                document.getElementById("messageresponse").innerText = result;
            }).catch((error) => {
            document.getElementById("messageresponse").innerText = error;
        });
    };

    ipcRenderer.on('general-update', (event, message)=>{
        const textArea = document.getElementById("messageresponse");
        console.log(message);
        textArea.innerText = message + "\n" + textArea.innerText;
    })

    ipcRenderer.on('image-update', (event, anImage)=>{
        console.log("on image update");
        const imageArea = document.getElementById("imageresponse");
        console.log(anImage);
        imageArea.innerText = JSON.stringify(anImage, null, 2);
    })
    
</script>
</body>
</html>